@using AmbienteEscolar.Business.Classes
@using AmbienteEscolar.Business.BancoDeDados
@using AmbienteEscolar.Business.Repositorios

@{
    BancoDados.DBConnect();

    Usuario usuario = new Usuario();

    usuario.Login = Request.Form["login"];
    usuario.Senha = Request.Form["senha"];


    if (UsuarioRepository.Login(usuario.Login, usuario.Senha))
    {
        HttpCookie cookie = new HttpCookie("UserLogin");
        Sessao sessao = UsuarioRepository.BuscarSessao(usuario.Login);
        cookie.Value = $"{sessao.Nome},{sessao.Matricula},{sessao.Registro},{sessao.NivelAcesso.Id},{sessao.NivelAcesso.Descricao}";
        DateTime dtNow = DateTime.Now;
        // Cookie expira em uma hora.
        TimeSpan tsMinute = new TimeSpan(0, 1, 0, 0);
        cookie.Expires = dtNow + tsMinute;
        Response.Cookies.Add(cookie);
        <text>
            <script>
                window.location.href = "/View/Home/Menu";
            </script>
        </text>
    }
    else
    {
        <text>
            <script>
                window.location.href = "/Login";
                alert("Usuário ou Senha inválidos. Tente novamente.");
            </script>
        </text>
    }
}